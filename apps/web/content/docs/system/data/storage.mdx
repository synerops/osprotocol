---
title: Storage
description: Durable source of truth with optimistic concurrency support
---

## Overview

The Storage capability provides durable, authoritative data persistence. Unlike cache, storage entries are the source of truth — they survive restarts, have no automatic expiration, and support optimistic concurrency for safe concurrent access.

## Interface

```typescript
interface Storage {
  get<T>(key: string): Promise<StorageEntry<T> | null>
  put<T>(key: string, data: T, expectedVersion?: number): Promise<StorageEntry<T>>
  delete(key: string): Promise<boolean>
  has(key: string): Promise<boolean>
  list(prefix: string): Promise<string[]>
}
```

### StorageEntry

Each storage entry carries versioning metadata for concurrency control:

```typescript
interface StorageEntry<T = unknown> {
  data: T                              // The stored data
  createdAt: number                    // When this entry was created (Unix ms)
  updatedAt: number                    // When this entry was last updated (Unix ms)
  version?: number                     // Version for optimistic concurrency
  metadata?: Record<string, unknown>   // Extensible metadata
}
```

## Use Case: Inter-Agent State Sharing

Multiple agents can share state through storage using a consistent key convention:

```typescript
// Agent A stores user preferences
await storage.put('user:123:preferences', {
  theme: 'dark',
  language: 'en',
  notifications: true
})

// Agent B retrieves them
const prefs = await storage.get('user:123:preferences')
```

### Optimistic Concurrency

When multiple agents may update the same entry, use version-based concurrency control:

```typescript
// Read current version
const entry = await storage.get('counter:visits')

// Update with expected version — fails if another agent updated in between
await storage.put('counter:visits', entry.data + 1, entry.version)
```

### Key Enumeration

List all keys under a prefix for discovery or batch operations:

```typescript
// Find all preferences for a user
const keys = await storage.list('user:123:')
// → ['user:123:preferences', 'user:123:history', 'user:123:sessions']
```

## Storage vs Cache

| Aspect | Storage | Cache |
|--------|---------|-------|
| **Durability** | Survives restarts | Evictable at any time |
| **Expiration** | None (manual delete) | TTL-based |
| **Authority** | Source of truth | Derived data |
| **Concurrency** | Optimistic versioning | Last write wins |
| **Use case** | Agent state, config, records | API responses, computed results |

## Integration

Storage integrates with:

- **[Cache](/docs/system/data/cache)**: Cache may be backed by storage internally
- **[Context](/docs/context/memory)**: Agent memories may be persisted via storage
- **[Actions](/docs/actions/tools)**: Actions store results for durability
- **[System](/docs/system)**: Storage is part of the system infrastructure layer
